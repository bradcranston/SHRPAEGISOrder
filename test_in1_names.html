<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IN1 Name Fields Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow">
        <h1 class="text-2xl font-bold mb-6">IN1 Name Fields Test</h1>
        
        <div class="mb-6">
            <h2 class="text-lg font-semibold mb-3">Test Sample Data</h2>
            <div class="bg-gray-50 p-4 rounded">
                <p><strong>Insured Last Name:</strong> <span id="display-IN116family">GAMGEE</span></p>
                <p><strong>Insured First Name:</strong> <span id="display-IN116given">SAMWISE</span></p>
                <p><strong>Insured Middle Name:</strong> <span id="display-IN116middle">S</span></p>
            </div>
        </div>

        <div class="mb-6">
            <h2 class="text-lg font-semibold mb-3">Expected HL7 Output</h2>
            <div class="bg-blue-50 p-4 rounded font-mono text-sm">
                IN1|1|PH17236|4X0012|DigiMark|P.O. Box 112233^^Big Hill^TN^37171|||117019172||||||||<span class="bg-yellow-200">GAMGEE^SAMWISE^S</span>|E|198907086000|53 Bagshot Row^^Middle Earth^TN^35431|||||||||||||||||9101003799|||||||||||||ABC928169482|
            </div>
        </div>

        <div class="mb-6">
            <button id="testBtn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                Test IN1 Segment Generation
            </button>
        </div>

        <div id="results" class="mb-6">
            <h2 class="text-lg font-semibold mb-3">Generated HL7 Output</h2>
            <div id="output" class="bg-gray-50 p-4 rounded font-mono text-sm break-all"></div>
        </div>

        <div id="analysis" class="mb-6">
            <h2 class="text-lg font-semibold mb-3">Analysis</h2>
            <div id="analysisOutput" class="bg-green-50 p-4 rounded"></div>
        </div>
    </div>

    <script src="src/index.js"></script>
    <script>
        document.getElementById('testBtn').addEventListener('click', function() {
            // Mock required functions if needed
            if (typeof getVal === 'undefined') {
                window.getVal = function(id) {
                    const element = document.getElementById(id);
                    return element ? element.textContent.trim() : '';
                };
            }

            if (typeof esc === 'undefined') {
                window.esc = function(str) {
                    return str ? str.toString().replace(/[|^~\\&]/g, function(match) {
                        switch (match) {
                            case '|': return '\\F\\';
                            case '^': return '\\S\\';
                            case '~': return '\\T\\';
                            case '\\': return '\\E\\';
                            case '&': return '\\R\\';
                            default: return match;
                        }
                    }) : '';
                };
            }

            if (typeof formatXPN === 'undefined') {
                window.formatXPN = function(family, given, middle, suffix, prefix) {
                    const parts = [
                        family || '',
                        given || '',
                        middle || '',
                        suffix || '',
                        prefix || ''
                    ];
                    
                    // Remove trailing empty parts
                    while (parts.length > 0 && parts[parts.length - 1] === '') {
                        parts.pop();
                    }
                    
                    return parts.join('^');
                };
            }

            // Test the IN1.16 name formatting
            const family = getVal('display-IN116family');
            const given = getVal('display-IN116given');
            const middle = getVal('display-IN116middle');
            
            const formattedName = formatXPN(family, given, middle);
            
            // Display results
            document.getElementById('output').textContent = formattedName;
            
            // Analysis
            const expected = 'GAMGEE^SAMWISE^S';
            const isCorrect = formattedName === expected;
            
            const analysisDiv = document.getElementById('analysisOutput');
            analysisDiv.innerHTML = `
                <p><strong>Generated:</strong> ${formattedName}</p>
                <p><strong>Expected:</strong> ${expected}</p>
                <p><strong>Result:</strong> <span class="${isCorrect ? 'text-green-600' : 'text-red-600'}">${isCorrect ? 'PASS ✓' : 'FAIL ✗'}</span></p>
                <p><strong>Format:</strong> XPN (Extended Person Name) with caret (^) separators</p>
                <p><strong>Fields:</strong> Family^Given^Middle^Suffix^Prefix</p>
            `;
        });

        // Auto-run test on page load
        window.addEventListener('load', function() {
            document.getElementById('testBtn').click();
        });
    </script>
</body>
</html>
